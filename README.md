## ê°œì¸ - ê²Œì‹œê¸€ í† ì´ í”„ë¡œì íŠ¸

<hr/>

### âš¡í”„ë¡œì íŠ¸ ì†Œê°œ

#### ì‹œì‘í•˜ê²Œ ëœ ì´ìœ 
> - SSR(Server Side Rendering) í”„ë¡œì íŠ¸
> - MyBatisë¥¼ ì´ìš©í•˜ì—¬ ê²Œì‹œê¸€ì„ ë§Œë“¤ê¸°
> - í˜ì´ì§• ì²˜ë¦¬ í•™ìŠµ
> - ê²Œì‹œê¸€ ì¢‹ì•„ìš” ê¸°ëŠ¥ êµ¬í˜„
> - Spring Batch ì´ìš©

<hr/>

### âš™ï¸ ê¸°ìˆ  ì •ë³´
<div>
<img src="https://img.shields.io/badge/Java-007396?style=flat-square&logo=java&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring-6DB33F?style=flat-square&logo=spring&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring Batch-6DB33F?style=flat-square&logo=spring&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring Boot-6DB33F?style=flat-square&logo=springboot&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/Spring Security-6DB33F?style=flat-square&logo=springsecurity&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/MyBatis-001202?style=flat-square&logo=mybatis&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/MYSQL-4479A1?style=flat-square&logo=mysql&logoColor=FFFFFF"/>
<img src="https://img.shields.io/badge/H2 Database-4479A1.svg?&style=flat-square&logo=&logoColor=white">
<img src="https://img.shields.io/badge/Thymeleaf-005F0F.svg?&style=flat-square&logo=thymeleaf&logoColor=white">

<hr/>

### ğŸš§ ë²„ì „ ê´€ë¦¬ ë° ì§„í–‰
> 2023.10~2023.12 Version 1
- [x] Spring Securityë¥¼ ì´ìš©í•˜ì—¬ íšŒì›ê°€ì… ë° ë¡œê·¸ì¸ êµ¬í˜„ (ê¶Œí•œ : ROLE_USER, ROLE_ADMIN)
- [x] Member, Board CRUD ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
- [x] Board(ê²Œì‹œíŒ) í˜ì´ì§• ì²˜ë¦¬ ì¶”ê°€
- [x] ê¶Œí•œì— ë”°ë¥¸ í•˜ì´í¼ë§í¬ ì„¤ì • (thymeleaf-extras-spring security 5 ì‚¬ìš©)
- [x] íšŒì›ê°€ì…, ë¡œê·¸ì¸ Bean Validation ì„¤ì • ë° Thymeleaf, ì²˜ë¦¬ ì‹¤íŒ¨  ë‚˜ì˜¤ê²Œ í•˜ê¸° (Binding Result)
- [x] FILE í…Œì´ë¸” ì‘ì„± ë° ì¡°íšŒ ì§ˆì˜ ë° insert ì§ˆì˜ ì‘ì„±
- [x] Board File domain ëª¨ë¸ ì‘ì„± ë° board Mapper result Map ì‘ì„± ë° 1:N joinìœ¼ë¡œ í•œë°© ì§ˆì˜ ì‘ì„± (SELECT)
- [x] ê²Œì‹œê¸€ ì‘ì„± ì‹œ íŒŒì¼ ì—…ë¡œë“œ ê°€ëŠ¥í•˜ê²Œ (FILE í…Œì´ë¸”) ì‘ì„± (FileStore, UploadFile)
- [x] ì´ë¯¸ì§€ íŒŒì¼, ì²¨ë¶€ íŒŒì¼ êµ¬ë¶„í•˜ê²Œ í•˜ì—¬ (FILE_IMAGE_NY ì¹¼ëŸ¼) ì²¨ë¶€ íŒŒì¼ì€ ë‚´ë ¤ë°›ì„ ìˆ˜ ìˆê²Œ í•˜ê³ , ì´ë¯¸ì§€ íŒŒì¼ì€ IMG íƒœê·¸ì—ì„œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê²Œ ë¶„ë¦¬
- [x] ì´ë¯¸ì§€ íŒŒì¼ ì—…ë¡œë“œ ì‹œ í™•ì¥ì ê²€ì‚¬ (.jpg, .png, .gif)
- [x] íŒŒì¼ ìš©ëŸ‰ í¬ë©´ ì—ëŸ¬ í˜ì´ì§€ ë° ê¸€ë¡œë²Œ ì˜¤ë¥˜  X -> MaxFileSize ë° MaxRequestSize ì„¤ì • ë° Javascriptë¡œ íŒŒì¼ ìš©ëŸ‰ ì´ìƒ ì‹œ alert ì²˜ë¦¬
- [x] ì´ë¯¸ì§€ íŒŒì¼ ì´ë¦„ìœ¼ë¡œ ë‹¤ìš´ ë°›ì„ ë•Œ DBì— ì¡´ì¬í•˜ì§€ ì•Šì„ ê²½ìš° 404 ì˜¤ë¥˜ í˜ì´ì§€ ì‘ë‹µ
- [x] ì´ë¯¸ì§€ íŒŒì¼ì€ ìµœëŒ€ 3ê°œê¹Œì§€ ì—…ë¡œë“œ
- [x] ê²Œì‹œê¸€ Repository(Mapper) ì‚­ì œ ë° ìˆ˜ì •ì§ˆì˜ ì‘ì„± ë° í…ŒìŠ¤íŠ¸
- [x] ì‚¬ìš©ì Exception ì •ì˜ ë° Controller Advice ë° Exception Handlerìœ¼ë¡œ ì˜ˆì™¸ í˜ì´ì§€ ë°˜í™˜
- [x] ê²Œì‹œê¸€ì„ ì‚­ì œ í•  ë•Œ board_delete_dateì— ì‚­ì œ ì‹œê°„ ê°’ Update
- [x] ê²Œì‹œê¸€ì„ ì¡°íšŒ ì‹œ í˜ì´ì§• ì²˜ë¦¬ì—ì„œ í•„ìš”í•œ getPageMaxCount ì—ì„œ where ë¬¸ ì‘ì„± (ê²Œì‹œê¸€ ì‚­ì œ ë‚ ì§œê°€ null ì¼ ê²½ìš°ì—ë§Œ ì¹´ìš´íŠ¸)
- [x] ê²Œì‹œê¸€ì„ ì‚­ì œ ë° ìˆ˜ì •í•  ë•Œ ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²Œì‹œê¸€ì¸ì§€, ì´ë¯¸ ì‚­ì œëœ ê²Œì‹œê¸€ì¸ì§€, ê²Œì‹œê¸€ ê¸€ì“´ì´ì¸ì§€ í™•ì¸ ë° Exception ì²˜ë¦¬
- [x] ê²Œì‹œê¸€ ì‚­ì œ, ìˆ˜ì • í¼ ì‘ì„± ë° ì»¨íŠ¸ë¡¤ëŸ¬ ì‘ì„±
- [x] ê²Œì‹œê¸€ì„ ìˆ˜ì • í•  ë•Œ ì²¨ë¶€ íŒŒì¼ ë° ì´ë¯¸ì§€ ë³€ê²½ ì‹œ ì¡´ì¬ í–ˆë˜ íŒŒì¼ì´ ì¡´ì¬ í•˜ì§€ ì•Šì„ ê²½ìš° DELETE, íŒŒì¼ì´ ì¶”ê°€ëœ ê²½ìš° INSERT (ì €ì¥ì†Œì—ì„œë„ íŒŒì¼ ì‚­ì œ ë° ì¶”ê°€)
- [x] RuntimeException ìƒì† ë°›ëŠ” ì‚¬ìš©ì ì •ì˜ ì˜ˆì™¸ ë§Œë“¤ê¸°
- [x] ëŒ“ê¸€ ì‘ì„± ë° ëŒ“ê¸€ ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€
- [x] ê²Œì‹œê¸€ ë° ëŒ“ê¸€ì„ ê°ê° ë‹¤ë¥¸ í˜ì´ì§• ì²˜ë¦¬(ë ˆì½”ë“œ í¬ê¸° ë° í˜ì´ì§€ í¬ê¸° ê°ê° ë‹¤ë¥´ê²Œ)ë¡œ ë¶„ë¦¬í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì—, ì¶”ìƒ í´ë˜ìŠ¤ Searchë¥¼ ë§Œë“¤ì–´ì„œ BoardSearchDto(ê²Œì‹œê¸€DTO), ReplySearchDto(ëŒ“ê¸€DTO)ë¡œ ë¶„ë¦¬
- [x] Pagination ìƒì„±ì ë°©ë²•ì—ì„œëŠ” Search(ìƒì†ë°›ì€ ì¶”ìƒ í´ë˜ìŠ¤)ë¡œ ì—… ìºìŠ¤íŒ… í›„ ë¡œì§ ì§„í–‰ (ë‹¤í˜•ì„±)
- [x] í‚¤ì›Œë“œë¡œ ê²€ìƒ‰í•˜ê¸°, ìµœê·¼ ìˆœ ì •ë ¬,
- [x] ë‹‰ë„¤ì„ Unique Keyë¡œ ë³€ê²½ (íšŒì›ê°€ì… ì‹œ ì¤‘ë³µ ì œê±°)
- [x] ìŠ¤í”„ë§ ë°°ì¹˜ë¥¼ ì´ìš©í•˜ì—¬ ì‚­ì œëœ ì§€ 7ì¼ì´ ì§€ë‚˜ë©´ DBì—ì„œë„ ì‚­ì œ
- [x] ë°°ì¹˜(Batch): Board ì‚­ì œ, ì œì•½ì¡°ê±´ ON DELETE CASCADEë¡œ ì¸í•˜ì—¬ FILE í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ” ì—°ê´€ëœ ì¹¼ëŸ¼ ì‚­ì œ
- [x] ê²Œì‹œê¸€ ì‚­ì œ ì‹œ FILE í…Œì´ë¸”ì˜ ë°ì´í„°ë„ ì‚­ì œë˜ê¸° ë•Œë¬¸ì— ìŠ¤í† ë¦¬ì§€ì— ìˆëŠ” íŒŒì¼ë„ ê°™ì´ ì‚­ì œí•œë‹¤.
- [x] ê²Œì‹œê¸€ ë³µêµ¬ í˜ì´ì§€ ì‘ì„± ë° ê²Œì‹œê¸€ ë³µêµ¬ ë¡œì§ ì¶”ê°€

> 2024.03~2024.03 Version 2
- [x] ê²Œì‹œê¸€ ì¢‹ì•„ìš”(Likes) í…Œì´ë¸” ë° ì¶”ê°€, ì‚­ì œ ê¸°ëŠ¥ ì¶”ê°€
- [x] ê²Œì‹œê¸€ ì¡°íšŒ ì‹œ ì¢‹ì•„ìš” ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€

<hr/>

### âš’ï¸ í”„ë¡œì íŠ¸ ì§„í–‰ ì¤‘ ë¬¸ì œ ë°œìƒ ë° í•´ê²° 
#### ë¬¸ì œ 
BoardServiceì—ì„œ Fileê³¼ Board ê´€ë ¨ ë¡œì§ì´ ìˆëŠ”ë° ë¡œì§ ì§„í–‰ ë„ì¤‘ Exceptionìœ¼ë¡œ ì¸í•˜ì—¬ rollback ë˜ì–´ë„ íŒŒì¼ì´ ì‚­ì œê°€ ë˜ëŠ” í˜„ìƒì´ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.
#### í•´ê²° ë°©ì•ˆ
BoardServiceì— Fileê³¼ Board ê´€ë ¨ ë¡œì§ì´ í•œë²ˆì— ì‘ì„±ë˜ì–´ í•œ íŠ¸ëœì­ì…˜ ì•ˆì—ì„œ ì´ë£¨ì–´ì§€ê¸° ë•Œë¬¸ì— ìƒê¸´ ë¬¸ì œì—¬ì„œ, BoardServiceì—ì„œ ì‚­ì œí•  íŒŒì¼ì„ ArrayListë¡œ ë‹´ì•„ ë°˜í™˜í•˜ì—¬ ì»¨íŠ¸ë¡¤ëŸ¬ì—ì„œ ë°˜í™˜ ë°›ì€ ë¦¬ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  FileServiceë¡œ ë³´ë‚´ íŒŒì¼ ì‚­ì œë¥¼ ì§„í–‰í•˜ì˜€ìŠµë‹ˆë‹¤.
#### íšŒê³ ë¡
ì²˜ìŒ ì„¤ê³„ì—ì„œ File ê´€ë ¨ëœ ë¡œì§ì´ ë§ì§€ ì•Šì„ ê²ƒ ê°™ì•„ BoardServiceì— í•¨ê»˜ ì‘ì„±ì„ í–ˆëŠ”ë° ì½”ë“œì˜ ë³µì¡ì„±ê³¼ ì±…ì„ì´ ë§ì•„ì§€ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ì•ìœ¼ë¡œ ì„¤ê³„ í•  ë•ŒëŠ” ë‹¨ì¼ ì±…ì„ ì›ì¹™ì„ ì˜ ë”°ë¼ì•¼ê² ë‹¤ëŠ” ë°°ì›€ì„ ì–»ì—ˆìŠµë‹ˆë‹¤. (SOLID, SRP ë‹¨ì¼ ì±…ì„ ì›ì¹™)

<hr/>

### ğŸ’¡ í”„ë¡œì íŠ¸ ì‹¤í–‰ ì´ë¯¸ì§€
#### ìµœì´ˆ í™”ë©´(ë©”ì¸)
![image1](./md_resource/images/1.png)
#### ëª©ë¡ (ë©”ì¸, ë¡œê·¸ì¸, íšŒì›ê°€ì…)
![image2](./md_resource/images/2.png)
#### íšŒì› ê°€ì…
![image3](./md_resource/images/3.png)
#### ë¡œê·¸ì¸
![image4](./md_resource/images/4.png)
#### ë¡œê·¸ì¸ ëœ ìµœì´ˆ í™”ë©´(ë©”ì¸)
![image5](./md_resource/images/5.png)
#### ë¡œê·¸ì¸ ëœ ëª©ë¡
![image6](./md_resource/images/6.png)
#### ê²Œì‹œê¸€ ëª©ë¡
![image7](./md_resource/images/7.png)
![image8](./md_resource/images/8.png)
#### ê²Œì‹œê¸€ ì‘ì„±
![image9](./md_resource/images/9.png)
#### ì‘ì„±ëœ ê²Œì‹œê¸€
![image10](./md_resource/images/10.png)
#### ê²Œì‹œê¸€ ìƒì„¸
![image11](./md_resource/images/11.png)
#### ëŒ“ê¸€ì´ ì‘ì„± ëœ ê²Œì‹œê¸€
![image12](./md_resource/images/12.png)
#### í˜ì´ì§• ì²˜ë¦¬ê°€ ëœ ëŒ“ê¸€
![image13](./md_resource/images/13.png)
#### ê²Œì‹œê¸€ ìˆ˜ì • 
![image14](./md_resource/images/14.png)
#### ìˆ˜ì • ëœ ê²Œì‹œê¸€ 
![image15](./md_resource/images/15.png)
#### ì‚­ì œ ëœ ê²Œì‹œê¸€ 
![image16](./md_resource/images/16.png)
#### ê²Œì‹œê¸€ ë³µêµ¬
![image17](./md_resource/images/17.png)

![image18](./md_resource/images/18.png)
![image19](./md_resource/images/19.png)
![image20](./md_resource/images/20.png)

<hr/>

### ğŸ” í”„ë¡œì íŠ¸ ìƒì„¸
#### ERD-Cloud
![image-erd](./md_resource/image-erd.png)

<hr/>

### ğŸŒ³ ê°œë°œ í™˜ê²½

- Project: Gradle
- SpringBoot: 2.7.15
- Language: Java 11
- Dependencies
  - mybatis-spring-boot-starter:2.3.1
  - spring-boot-starter-batch
  - spring-boot-starter-quartz
  - spring-boot-starter-security
  - spring-boot-starter-web
  - spring-boot-starter-validation
  - spring-boot-starter-thymeleaf
  - spring-boot-starter-test
  - mysql-connector-j
  - lombok

<br/>
<hr/>

### ğŸ¶ ë°°í¬ ê³¼ì •
#### ì‚¬ìš© íˆ´
- VMWare Workstation 17 player, Putty, FileZilla
- HostOS: Windows 11
- guestOS: CentOS Stream 9

#### ë²„ì „
- nginx: 1.20.1
- MySQL: 8.4.1
- JDK: 17.0.6

#### ìˆœì„œ
1. ê°€ìƒ OS VM Ware í”„ë¡œê·¸ë¨ ì„¤ì¹˜
2. ìš´ì˜ì²´ì œ CentOS Stream 9 ì„¤ì¹˜
3. Puttyë¡œ ì ‘ì†í•  ê´€ë¦¬ì ê³„ì • ìƒì„±
4. ì ‘ì†ì€ ì™¸ë¶€ ì„œë²„ê°€ ìˆë‹¤ê³  ê°€ì •í•˜ì—¬ Puttyë¡œ SSH ì ‘ì† ë° íŒŒì¼ì€ FileZillaë¥¼ í†µí•´ íŒŒì¼ ì˜®ê¸°ê¸°
5. Java Development Kit(JDK) ì„¤ì¹˜
6. nginx ì„¤ì¹˜, ì ‘ì† í…ŒìŠ¤íŠ¸
7. Host OS ê³µìœ ê¸°ì— í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443), VMWare í¬íŠ¸ í¬ì›Œë”© ì„¤ì •(80, 443 ì™¸ë¶€ ì ‘ì† í—ˆìš©)
8. Firewall(ë°©í™”ë²½) 80, 443 í¬íŠ¸ ì—´ê¸°
9. 'ë‚´ë„ë©”ì¸.í•œêµ­' ë¬´ë£Œ DNS ì‚¬ìš© ë° Host ì™¸ë¶€ IP ì—°ê²°
10. MySQL ì„¤ì¹˜ ë° ê³„ì • ìƒì„±, ë°ì´í„°ë² ì´ìŠ¤ ìƒì„± ë° í…Œì´ë¸” ì¶”ê°€
11. Spring Boot ì´ìš©í•˜ì—¬ ë¹Œë“œ(BootJar) í›„ íŒŒì¼ systemctl(ì„œë¹„ìŠ¤) ë“±ë¡
12. Certbot ì´ìš©í•˜ì—¬ ë¬´ë£Œ lets' encrypt SSL/TLS ì„¤ì¹˜ ë° nginx.conf íŒŒì¼ ì„¤ì •
13. ì„œë¹„ìŠ¤ ì‹¤í–‰ ë° ì™¸ë¶€ ì‚¬ìš©ì ì ‘ì† í…ŒìŠ¤íŠ¸

#### nginx.conf
```nginx
user nginx;
worker_processes auto;
error_log /var/log/nginx/error.log;
pid /run/nginx.pid;

events {
    worker_connections 1024;
}

http {
    client_max_body_size 10M;

    upstream app {
       server 127.0.0.1:8080;
    }

    underscores_in_headers on;
    include /etc/nginx/mime.types;
    default_type application/octet-stream;

    # Redirect all Traffic to HTTPS
    server {
      listen 80;

	  location ~ /\.well-known/acme-challenge/ {
	  	allow all;
		root /var/www/letsencrypt;
	  }

      return 301 https://$host$request_uri;
    }
 
    server {
      listen 443 ssl http2;
      ssl_certificate /etc/letsencrypt/live/nineto6.p-e.kr/fullchain.pem;
      ssl_certificate_key /etc/letsencrypt/live/nineto6.p-e.kr/privkey.pem;

      # Disable SSL
      ssl_protocols TLSv1 TLSv1.1 TLSv1.2;
     
      # í†µì‹ ê³¼ì •ì—ì„œ ì‚¬ìš©í•  ì•”í˜¸í™” ì•Œê³ ë¦¬ì¦˜
      ssl_prefer_server_ciphers on;
      ssl_ciphers ECDH+AESGCM:ECDH+AES256:ECDH+AES128:DH+3DES:!ADH:!AECDH:!MD5;

      # Enable HSTS
      # clientì˜ browserì—ê²Œ httpë¡œ ì–´ë– í•œ ê²ƒë„ loadí•˜ì§€ ë§ë¼ê³  ê·œì œí•©ë‹ˆë‹¤.
      add_header Strict-Transport-Security "max-age=31536000" always;

      # SSL sessions
      ssl_session_cache shared:SSL:10m;
      ssl_session_timeout 10m;
    
      location / {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Nginx-Proxy true;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
      } 
    }
}
```

#### myboard.service
```
[Unit]
Description=MyBoard Description
After=syslog.target network.target myboard.service

[Service]
ExecStart=/bin/bash -c "exec java -jar /home/ikavon/server/myboard/myboard-0.0.1-SNAPSHOT.jar --spring.profiles.active=prod"
Restart=on-failure
RestartSec=10

User=root
group=root

[Install]
WantedBy=multi-user.taget
```
